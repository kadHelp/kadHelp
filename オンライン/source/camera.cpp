#include	"iextreme.h"
#include	"system/system.h"
#include	"sceneMain.h"

//*****************************************************************************************************************************
//
//		カメラクラス
//
//*****************************************************************************************************************************

//*****************************************************************************************************************************
//	初期化・解放
//*****************************************************************************************************************************
//------------------------------------------------------
//	初期化
//------------------------------------------------------
cCamera::cCamera()
{
	//	ビュー設定
	view = new iexView();
	view->SetProjection( 1.2f, 1.0f, 1000.0f );

	pos = Vector3( 5,10,-5);

	mode = CAMERA_NORMAL;
	max_dist = 8.0f;
	min_dist = 4.0f;
}

//------------------------------------------------------
//	解放
//------------------------------------------------------
cCamera::~cCamera()
{
	delete view;

}

//*****************************************************************************************************************************
//		更新
//*****************************************************************************************************************************

//------------------------------------------------------
//		通常カメラ
//------------------------------------------------------
void	cCamera::Normal()
{
	//	位置更新
	Vector3	v = PlayerPos - pos;
	v.y = 0;
	float	d = v.Length();

	//	最大距離設定
	if( d > max_dist )
	{
		pos = PlayerPos - v/d * max_dist;
	}
	//	最小距離設定
	if( d < min_dist )
	{
		pos = PlayerPos - v/d * min_dist;
	}

	pos.y = sceneMain::GetFloor(pos) + 1.9f;

	//	注視点設定
	target = PlayerPos + Vector3( 0, 1.5f, 0 );
}



//------------------------------------------------------
//		更新
//------------------------------------------------------
void cCamera::Update()
{
	//	モードごとの処理
	switch( mode )
	{
	case CAMERA_NORMAL:	Normal();	break;
	case CAMERA_FIXED:	break;
	}

	//	視点設定
	view->Set( pos, target );

}

//*****************************************************************************************************************************
//	描画準備
//*****************************************************************************************************************************
void cCamera::Activate()
{
	view->Activate();
	view->Clear();
}